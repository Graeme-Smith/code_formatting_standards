import sys,os ,   time
from typing import List,Dict,Optional,Union,TypedDict,Protocol,Any


def   foo( x , y=  10):
      if x>y:print("x>y");    return x -y
      elif x==y :
             return 0
      else:
       z= y-x
       return   z



class thing:
      def __init__( self ,name,items=None ):
             if items==None:items=[]
             self.name=name; self.items=items
      def add(self,item ):
                  self.items.  append(item)
      def __repr__(self):  return f"Thing(name={self.name!r}, items={self.items!r})"



# --- typing horror section below ---


class UserData(TypedDict):
          id:int
          name:str
          active:bool


class Greeter(Protocol):
        def greet(self, who: str) -> int: ...


class SimpleGreeter:
          # return type intentionally wrong
          def greet(self, who:int)-> str:
                   return "hello " + str(who)



def  bad_types_example( x:int , y:str )->  int:
            # wrong operation on annotated types
            z = x + y      # type: ignore[operator]
            return z


def make_user( raw:dict )->UserData:
       # missing required keys, wrong types etc.
       return { "id":"not-an-int",   "name":123, "active":"yes" }   # type: ignore[return-value]


def  typing_examples( )->None:
       a:int="string not int"
       b:str = 123
       nums:List[int]=[1,2,"three",4]  # type: ignore[list-item]
       mixed: Dict[str,int] = {"a":1,"b":"two"}  # type: ignore[dict-item]
       optional_val:Optional[int]="nope"
       thing_or_int:Union[int,"thing"]= SimpleGreeter()  # weird union use

       greeter:Greeter = SimpleGreeter()
       # expects str, giving int (plus protocol return mismatch)
       msg = greeter.greet(42)   # type: ignore[arg-type]
       print(msg)

       user = make_user({"id":1})
       print("user",user)

       # any abuse
       anything:Any = 123
       anything="now a str"
       anything= SimpleGreeter()
       anything.  greet("ok then")

       # fake "tests" for type checkers
       assert isinstance(a,str)   # but annotated as int
       assert isinstance(b,int)   # but annotated as str



def main( ):
        t= thing("example");   nums=list(range( 0,10))
        for n in nums :
                 v = foo(n,5);    # compute difference
                 if v%2==0: t.add(   v )
                 else:
                   # odd value
                      t.add(  v*  2)
        print ("Result:" ,t)
        messy_list=[1,2,3,4,5,6,7,8,9,10]

        very_long_string="this is a very very very very very very very very very very very very very long string that should probably be wrapped but isn't, and it just keeps going and going and going so your formatter has something to do"

        squared=[ i*i for i in messy_list if i%2==0];print("Squared evens:",squared)
        d={"a":1,"b":2, "c"  :3}
        for k in d:   print("key",k,"value",d [k])
        print("len:", len(very_long_string) )

        # call the typing examples so they're not "unused"
        if time.time() < 0:   # never true at runtime, but type checkers still see the code
                 typing_examples()



if __name__=="__main__" :
    main( )
